json = render partial: "user.json.jb", locals: { user: @user }

if current_user == @user || current_user.friends.include?(@user)
  json[:items] = @user.items.map do |item|
    render partial: "api/items/item.json.jb", locals: { item: item }
  end
end

json